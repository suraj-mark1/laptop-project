<form method="get" action="">
  <input type="text" name="q" placeholder="Search..." value="{{ request.GET.q }}">

  <select name="processor">
    <option value="">All Processors</option>
    <option value="i3" {% if request.GET.processor == "i3" %}selected{% endif %}>i3</option>
    <option value="i5" {% if request.GET.processor == "i5" %}selected{% endif %}>i5</option>
    <option value="i7" {% if request.GET.processor == "i7" %}selected{% endif %}>i7</option>
  </select>

  <select name="ram">
    <option value="">All RAM</option>
    <option value="4" {% if request.GET.ram == "4" %}selected{% endif %}>4 GB</option>
    <option value="8" {% if request.GET.ram == "8" %}selected{% endif %}>8 GB</option>
    <option value="16" {% if request.GET.ram == "16" %}selected{% endif %}>16 GB</option>
  </select>

  <input type="number" name="min_price" placeholder="Min ₹" value="{{ request.GET.min_price }}">
  <input type="number" name="max_price" placeholder="Max ₹" value="{{ request.GET.max_price }}">

  <button type="submit">Filter</button>
</form>

<hr>

<form id="compare-form" method="get" action="{% url 'compare_laptops' %}">
  {% for laptop in laptops %}
    <div style="border: 1px solid #ddd; padding: 10px; margin: 10px;">
      <input type="checkbox" name="ids" value="{{ laptop.id }}" class="compare-checkbox">
      <strong>{{ laptop.brand }} {{ laptop.model }}</strong> – ₹{{ laptop.price }}  
      <p>{{ laptop.processor }} | {{ laptop.ram }} GB RAM | {{ laptop.storage }}</p>
    </div>
  {% empty %}
    <p>No laptops found matching your criteria.</p>
  {% endfor %}
  
  {% if laptops %}
    <button type="submit">Compare Selected (Max 3)</button>
  {% endif %}
</form>

<script>
  const checkboxes = document.querySelectorAll('.compare-checkbox');
  const MAX_SELECTION = 3;

  checkboxes.forEach(cb => {
    cb.addEventListener('change', function () {
      const selected = document.querySelectorAll('.compare-checkbox:checked');
      if (selected.length > MAX_SELECTION) {
        alert('You can compare only up to 3 laptops.');
        this.checked = false;
      }
    });
  });
</script>
